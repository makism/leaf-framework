<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>leaf: leaf/core/log/Logger.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<h1>leaf/core/log/Logger.php</h1><a href="Logger_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ﻿&lt;?php
<a name="l00039"></a><a class="code" href="classleaf__Logger.html">00039</a> <span class="keyword">final</span> <span class="keyword">class </span><a class="code" href="classleaf__Logger.html">leaf_Logger</a> <span class="keyword">extends</span> leaf_Base implements <a class="code" href="interfaceleaf__Log.html">leaf_Log</a> {
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="classleaf__Logger.html#8c160927e08e1b4e328b39431691b96d">00041</a>     <span class="keyword">const</span> <a class="code" href="classleaf__Logger.html#8c160927e08e1b4e328b39431691b96d">LEAF_REG_KEY</a> = <span class="stringliteral">"logger"</span>;
<a name="l00042"></a>00042     
<a name="l00043"></a><a class="code" href="classleaf__Logger.html#768e31f3fa5b2c9e33ca0c52dcf6782e">00043</a>     <span class="keyword">const</span> <a class="code" href="classleaf__Logger.html#768e31f3fa5b2c9e33ca0c52dcf6782e">LEAF_CLASS_ID</a> = <span class="stringliteral">"LEAF_LOGGER-1_0_dev"</span>;
<a name="l00044"></a>00044     
<a name="l00045"></a>00045 
<a name="l00051"></a><a class="code" href="classleaf__Logger.html#cb5467db26fa02f06a73b11c6b2713f4">00051</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#cb5467db26fa02f06a73b11c6b2713f4">$filename</a>= NULL;
<a name="l00052"></a>00052         
<a name="l00058"></a><a class="code" href="classleaf__Logger.html#42994969cfe668fe427508a08b856d6c">00058</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#42994969cfe668fe427508a08b856d6c">$stampPat</a>= NULL;
<a name="l00059"></a>00059         
<a name="l00065"></a><a class="code" href="classleaf__Logger.html#7b32c116bc0eb480fbf5e2d7fba4c2f4">00065</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#7b32c116bc0eb480fbf5e2d7fba4c2f4">$buffer</a>  = NULL;
<a name="l00066"></a>00066         
<a name="l00072"></a><a class="code" href="classleaf__Logger.html#35048dfae76752d48e36e19eeab3201c">00072</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#35048dfae76752d48e36e19eeab3201c">$threshold</a>= NULL;
<a name="l00073"></a>00073         
<a name="l00079"></a><a class="code" href="classleaf__Logger.html#1cac078ec8bc8216bbd0e8b9b026ed64">00079</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#1cac078ec8bc8216bbd0e8b9b026ed64">$levels</a>   = array(<span class="stringliteral">"All"</span>, <span class="stringliteral">"Debug"</span>, <span class="stringliteral">"Warning"</span>, <span class="stringliteral">"Info"</span>, <span class="stringliteral">"None"</span>);
<a name="l00080"></a>00080         
<a name="l00086"></a><a class="code" href="classleaf__Logger.html#15c6c393fc0705c338d691592b4b6cc3">00086</a>         <span class="keyword">private</span> <a class="code" href="classleaf__Logger.html#15c6c393fc0705c338d691592b4b6cc3">$fp</a> = NULL;
<a name="l00087"></a>00087         
<a name="l00088"></a>00088         
<a name="l00096"></a><a class="code" href="classleaf__Logger.html#7b06c730a23dc6df43df3ba5b1fdec27">00096</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#7b06c730a23dc6df43df3ba5b1fdec27">__construct</a>(<a class="code" href="classleaf__Logger.html#7b32c116bc0eb480fbf5e2d7fba4c2f4">$buffer</a>=<span class="keyword">false</span>)
<a name="l00097"></a>00097         {
<a name="l00098"></a>00098             <span class="comment">/*</span>
<a name="l00099"></a>00099 <span class="comment">             * In case this is a development release, capture all errors and</span>
<a name="l00100"></a>00100 <span class="comment">             * messages.</span>
<a name="l00101"></a>00101 <span class="comment">         *</span>
<a name="l00102"></a>00102 <span class="comment">             * Σε περίπτωση που πρόκειται για έκδοση υπό-ανάπτυξη, θα καταγράψουμε</span>
<a name="l00103"></a>00103 <span class="comment">             * όλα τα σφάλματα και μηνύματα.</span>
<a name="l00104"></a>00104 <span class="comment">             */</span>
<a name="l00105"></a>00105             <span class="comment">/*if (LEAF_REL_STATUS=='DEV')</span>
<a name="l00106"></a>00106 <span class="comment">            $this-&gt;threshold = "All";</span>
<a name="l00107"></a>00107 <span class="comment">        else</span>
<a name="l00108"></a>00108 <span class="comment">            $this-&gt;threshold = Registry::instance()-&gt;config['log_level'];*/</span>
<a name="l00109"></a>00109         $this-&gt;threshold = $this-&gt;<a class="code" href="Debug_8php.html#6ee99e9658fac2942f0853f7b6f3b17a">config</a>['log_level'];
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="comment">/*</span>
<a name="l00112"></a>00112 <span class="comment">         * Output filename.</span>
<a name="l00113"></a>00113 <span class="comment">         *</span>
<a name="l00114"></a>00114 <span class="comment">         * Το αρχείο στο οποίο θα γράψουμε.</span>
<a name="l00115"></a>00115 <span class="comment">         */</span>
<a name="l00116"></a>00116         $this-&gt;filename = <a class="code" href="index_8php.html#e5e911d5e4b693f7867f5f01e916804f">LEAF_VAR</a> . 'logs/' . date(<span class="stringliteral">"d_m_Y"</span>) . <span class="stringliteral">".log"</span>;
<a name="l00117"></a>00117         
<a name="l00118"></a>00118         $this-&gt;fp = fopen($this-&gt;filename, <span class="stringliteral">"a"</span>);
<a name="l00119"></a>00119         flock($this-&gt;fp, LOCK_EX);
<a name="l00120"></a>00120         
<a name="l00121"></a>00121         $this-&gt;log(<span class="stringliteral">"leaf Framework ("</span> . <a class="code" href="index_8php.html#4209a32e9d7060c589884209fbac52bc">LEAF_REL_STATUS</a> . <span class="stringliteral">") Inited on "</span> . date(<span class="stringliteral">"r"</span>));
<a name="l00122"></a>00122         $this-&gt;log(<span class="stringliteral">" -&gt; leaf has been checked, and found sanile!"</span>);
<a name="l00123"></a>00123         $this-&gt;log(<span class="stringliteral">"~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span>);
<a name="l00124"></a>00124         
<a name="l00125"></a>00125         <span class="comment">/*$this-&gt;log("Debug", "Registry has been instantiated");</span>
<a name="l00126"></a>00126 <span class="comment">        $this-&gt;log("Debug", "Config has been instantiated");</span>
<a name="l00127"></a>00127 <span class="comment">        $this-&gt;log("Debug", "Logger just instantiated");*/</span>
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129         
<a name="l00138"></a><a class="code" href="classleaf__Logger.html#5a909f309bae200a2031316f262be056">00138</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#5a909f309bae200a2031316f262be056">flush</a>($return=<span class="keyword">false</span>)
<a name="l00139"></a>00139         {
<a name="l00140"></a>00140                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>($this-&gt;buffer)&gt;0) {
<a name="l00141"></a>00141                         $tmp = $this-&gt;buffer;
<a name="l00142"></a>00142                         unset($this-&gt;buffer);
<a name="l00143"></a>00143                         
<a name="l00144"></a>00144                         <span class="keywordflow">if</span> ($return)
<a name="l00145"></a>00145                                 <span class="keywordflow">return</span> $tmp;
<a name="l00146"></a>00146                                 
<a name="l00147"></a>00147                 }
<a name="l00148"></a>00148                 
<a name="l00149"></a>00149                 <span class="keywordflow">return</span> NULL;
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         
<a name="l00157"></a><a class="code" href="classleaf__Logger.html#68995896c093a69f4374b6a2e0bca191">00157</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#68995896c093a69f4374b6a2e0bca191">end_flush</a>()
<a name="l00158"></a>00158         {
<a name="l00159"></a>00159             $this-&gt;<a class="code" href="classleaf__Logger.html#5a909f309bae200a2031316f262be056">flush</a>();
<a name="l00160"></a>00160             fwrite($this-&gt;fp, <span class="stringliteral">"\n"</span>);
<a name="l00161"></a>00161             flock($this-&gt;fp, LOCK_UN);
<a name="l00162"></a>00162             fclose($this-&gt;fp);
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164         
<a name="l00171"></a><a class="code" href="classleaf__Logger.html#8c9def74fc20b631193c2b371f36564c">00171</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#8c9def74fc20b631193c2b371f36564c">setTimeStampPattern</a>($pat)
<a name="l00172"></a>00172         {
<a name="l00173"></a>00173             $this-&gt;stampPat = $pat;
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175 
<a name="l00186"></a><a class="code" href="classleaf__Logger.html#9e3484ca2122997bab70bce50dfdab8d">00186</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#9e3484ca2122997bab70bce50dfdab8d">setLevel</a>($filterLevel)
<a name="l00187"></a>00187         {
<a name="l00188"></a>00188                 <span class="keywordflow">if</span> (array_key_exists($filterLevel, $this-&gt;levels)) {
<a name="l00189"></a>00189                     $this-&gt;threshold = $filterLevel;
<a name="l00190"></a>00190                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00191"></a>00191                 } <span class="keywordflow">else</span> {
<a name="l00192"></a>00192                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 
<a name="l00204"></a><a class="code" href="classleaf__Logger.html#b8f16a73e9c28532c80197f9c04e1736">00204</a>         <span class="keyword">public</span> function <a class="code" href="classleaf__Logger.html#b8f16a73e9c28532c80197f9c04e1736">__call</a>($method, $args)
<a name="l00205"></a>00205         {
<a name="l00206"></a>00206                 <span class="keywordflow">if</span> ($method==<span class="stringliteral">"log"</span>) {
<a name="l00207"></a>00207                     $s = <span class="keyword">sizeof</span>($args);
<a name="l00208"></a>00208                     
<a name="l00209"></a>00209                     <span class="keywordflow">if</span> ($s&gt;0) {
<a name="l00210"></a>00210                         <span class="keywordflow">if</span> ($s==1) {
<a name="l00211"></a>00211                             $msg = $args[0];
<a name="l00212"></a>00212                             fwrite($this-&gt;fp, $msg . <span class="stringliteral">"\n"</span>);
<a name="l00213"></a>00213                         } <span class="keywordflow">else</span> {
<a name="l00214"></a>00214                             
<a name="l00215"></a>00215                             <span class="keywordflow">if</span> (in_array($args[0], $this-&gt;levels)==FALSE)
<a name="l00216"></a>00216                                 ;
<a name="l00217"></a>00217                             
<a name="l00218"></a>00218                             $level = strtoupper($args[0]);
<a name="l00219"></a>00219                             
<a name="l00220"></a>00220                             <span class="keywordflow">if</span> ($this-&gt;threshold==$level || $this-&gt;threshold==<span class="stringliteral">"All"</span>) {
<a name="l00221"></a>00221                                     $msg   = $args[1];
<a name="l00222"></a>00222                                     $file  = ($s==3)
<a name="l00223"></a>00223                                                 ? <span class="stringliteral">"(file: "</span> . $args[2] . <span class="stringliteral">")"</span>
<a name="l00224"></a>00224                                                 : NULL;
<a name="l00225"></a>00225         
<a name="l00226"></a>00226                                 fwrite($this-&gt;fp, <span class="stringliteral">"[{$level}] {$msg} {$file}"</span> . <span class="stringliteral">"\n"</span>);
<a name="l00227"></a>00227                             }
<a name="l00228"></a>00228                         }
<a name="l00229"></a>00229                     }
<a name="l00230"></a>00230                 }
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 ?&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 22 16:59:25 2007 for leaf by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
